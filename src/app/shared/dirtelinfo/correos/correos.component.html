<dx-data-grid
  #gridEmails
  id="gridEmails"
  [dataSource]="DEmail"
  keyExpr="ITEM"
  [showBorders]="true"
  (onInitNewRow)="initNewRow($event)"
  (onRowInserting)="insertingRow($event)"
  (onRowInserted)="insertedRow($event)"
  (onRowUpdating)="updatingRow($event)"
  (onRowUpdated)="updatedRow($event)"
  (onRowRemoved)="removedRow($event)"
  (onEditingStart)="onEditingStart($event)"
  (onEditorPreparing)="onEditorPreparing($event)"
  (onToolbarPreparing)="onToolbarPreparingGrid($event)"
  (onRowPrepared)="onRowPrepared($event)"
  (onRowValidating)="onRowValidating($event)"
  (onSelectionChanged)="selectionGrid($event)"
  (onContentReady)="onContentReady($event)"
  (onCellClick)="onCellClick($event)"
  (onEditCanceled)="onEditCanceled($event)"
  >
    <dxo-editing
        mode="cell"
        [useIcons]="false" 
        [allowUpdating]="esEdicion"
        [allowDeleting]="false"
        [allowAdding]="esEdicion"
        >
        <dxo-texts
            confirmDeleteMessage="">
        </dxo-texts>
    </dxo-editing>      
    <dxo-selection
        selectAllMode="allPages"
        [showCheckBoxesMode]="esVisibleSelecc"
        mode="multiple">
    </dxo-selection>

    <dxi-column dataField="ITEM" [visible]="false">
    </dxi-column>
    <dxi-column dataField="EMAIL"
        caption="Email"
        validationMessageMode='always'
    >
        <dxi-validation-rule type="required" message="Se requiere un Email"></dxi-validation-rule>
        <!-- <dxi-validation-rule type="email" message="Email inválido"></dxi-validation-rule> -->
        <dxi-validation-rule
            type="custom"
            [message]="msgValidacion"
            [validationCallback]="valideEmail"
        >
        </dxi-validation-rule>
    </dxi-column>
    <dxi-column dataField="ETIQUETA"
        caption="Descripción"
        calculateDisplayValue="ETIQUETA"
    >
    </dxi-column>

    <div *dxTemplate="let cellInfo of 'tempEmail'">
        <dx-text-box 
            [inputAttr]="{ 'aria-label': 'Email' }"
            [(value)]="cellInfo.data.EMAIL"
            >
            <dx-validator>
                <dxi-validation-rule
                    type="required"
                    message="Se requiere un Email"
                ></dxi-validation-rule>
                <dxi-validation-rule
                    type="email"
                    message="Email inválido"
                ></dxi-validation-rule>
                <!-- <dxi-validation-rule
                    type="async"
                    message="Email ya registrado"
                    [validationCallback]="asyncValidation"
                ></dxi-validation-rule> -->
            </dx-validator>
        </dx-text-box>
    </div>

    <dxo-toolbar *ngIf="esEdicion">
        <dxi-item location="before">
            <div *dxTemplate>
                <dx-button icon="plus" matTooltip="Nuevo" (onClick)="operGrid($event,'new')" *ngIf="rowNew">
                </dx-button>
            </div>
        </dxi-item>
        <dxi-item location="before">
            <div *dxTemplate>
                <dx-button icon="edit" matTooltip="Actualizar" (onClick)="operGrid($event,'update')" *ngIf="rowEdit">
                </dx-button>
            </div>
        </dxi-item>
        <dxi-item location="before">
            <div *dxTemplate>
                <dx-button icon="trash" matTooltip="Eliminar" (onClick)="operGrid($event,'delete')" *ngIf="rowDelete">
                </dx-button>
            </div>
        </dxi-item>
        <dxi-item location="before">
            <div *dxTemplate>
                <dx-button icon="todo" matTooltip="Guardar" (onClick)="operGrid($event,'save')" *ngIf="rowApplyChanges">
                </dx-button>
            </div>
        </dxi-item>
        <dxi-item location="before">
            <div *dxTemplate>
                <dx-button icon="undo" matTooltip="Cancelar" (onClick)="operGrid($event,'cancel')" *ngIf="rowApplyChanges">
                </dx-button>
            </div>
        </dxi-item>
    </dxo-toolbar>

</dx-data-grid>