<dx-data-grid
    #gridItemsRecaudos
    id="gridItemsRecaudos"
    [dataSource]="DItemsRecaudos"
    [allowColumnResizing]="true"
    columnResizingMode="nextColumn"
    [focusedRowEnabled]="true"
    [rowAlternationEnabled]="true"
    [hoverStateEnabled]="true"
    keyExpr="ITEM"
    noDataText=""
    [showBorders]="true"
    [repaintChangesOnly]="true"
    (onInitNewRow)="initNewRow($event)"
    (onRowInserting)="insertingRow($event)"
    (onRowInserted)="insertedRow($event)"
    (onRowUpdating)="updatingRow($event)"
    (onRowUpdated)="updatedRow($event)"
    (onRowRemoved)="removedRow($event)"
    (onSelectionChanged)="selectionGrid($event)"
    (onEditingStart)="onEditingStart($event)"
    (onEditorPreparing)="onEditorPreparing($event)"
    (onToolbarPreparing)="onToolbarPreparingGrid($event)"
    (onRowPrepared)="onRowPrepared($event)"
    (onRowValidating)="onRowValidating($event)"
    (onFocusedRowChanged)="onFocusedRowChanged($event)"
    (onEditCanceled)="onEditCanceled($event)"
    (onCellPrepared)="onCellPrepared($event)"
    (onCellClick)="onCellClick($event)"
    >
  
    <dxo-editing
        mode="cell"
        [useIcons]="false" 
        [allowUpdating]="esEdicion"
        [allowDeleting]="false"
        [allowAdding]="esEdicion"
        >
        <dxo-texts
            confirmDeleteMessage="">
        </dxo-texts>
    </dxo-editing>      
      <dxo-selection
          selectAllMode="allPages"
          [showCheckBoxesMode]="esVisibleSelecc"
          mode="multiple">
      </dxo-selection>
  
    <dxi-column dataField="ITEM"
        [visible]="false">
    </dxi-column>
  
    <dxi-column dataField="ID_TARIFA"
        caption="Concepto"
        calculateDisplayValue="ID_TARIFA"
        cellTemplate="verTarifa"
        editCellTemplate="listaTarifa"
        >
    </dxi-column>

    <dxi-column 
        dataField="CANTIDAD" 
        caption="Cantidad" 
        alignment="right" 
        [setCellValue]="setCellCan" 
        dataType="number" 
        displayFormat="#,##0.00"
        [editorOptions]="{format: '#,##0.00'}" 
        cssClass="clsEncabHis">
        <dxo-format
            type="fixedPoint"
            [precision]="2">
        </dxo-format>
    </dxi-column>

    <dxi-column 
        dataField="VALOR_UNITARIO" 
        caption="Valor" 
        alignment="right" 
        [setCellValue]="setCellValor" 
        dataType="number" 
        displayFormat="#,##0.00"
        [editorOptions]="{format: '#,##0.00'}" 
        cssClass="clsEncabHis">
        <dxo-format
            type="fixedPoint"
            [precision]="2">
        </dxo-format>
    </dxi-column>

    <dxi-column 
        dataField="IVA" 
        caption="Iva" 
        alignment="right" 
        dataType="number" 
        [allowEditing]="false"
        displayFormat="#,##0.00"
        cssClass="clsEncabHis">
        <dxo-format
            type="fixedPoint"
            [precision]="2">
        </dxo-format>
    </dxi-column>

    <dxi-column 
        dataField="VALOR_TOTAL" 
        caption="Total" 
        alignment="right" 
        [allowEditing]="false"
        dataType="number" 
        displayFormat="#,##0.00"
        cssClass="clsEncabHis">
        <dxo-format
            type="fixedPoint"
            [precision]="2">
        </dxo-format>
    </dxi-column>

    <dxi-column dataField="DETALLE"
      caption="Detalle" >
    </dxi-column>

    <div *dxTemplate="let cellInfo of 'verTarifa'">
        {{ cellInfo.data.TARIFA }}
    </div>
    <div *dxTemplate="let cellInfo of 'listaTarifa'">
        <dx-select-box 
            #xs_ID_TARIFA
            id="xs_ID_TARIFA"
            [dataSource]="DTarifas" 
            [(value)]="cellInfo.data.ID_TARIFA"
            [searchEnabled]="true"
            displayExpr="ID_TARIFA"
            valueExpr="ID_TARIFA"
            searchMode="contains"
            [dropDownOptions]="{ width: 600 }"
            (onValueChanged)="onValueChangedTarifa($event, cellInfo)"
            >
            <div *dxTemplate="let data of 'item'">
              <div style="width: 40%; float:left">
                {{ data.ID_TARIFA }}
              </div>
              
              <div style="width: 60%; float:right; ">
                {{ data.DESCRIPCION }}
              </div>
            </div>

        </dx-select-box>
    </div>

    <dxi-column
        caption=""
        allowEditing="false">
    </dxi-column>

    <dxo-toolbar>
        <dxi-item location="before">
          <div *dxTemplate>
            <div style="font-size: 16px;">Items de la Factura</div> 
          </div>
        </dxi-item>

        <dxi-item location="before">
          <div *dxTemplate >
              <dx-select-box
                  [dataSource]="DAccionesRec"
                  [(value)]="accionesItems"
                  displayExpr="FILTRO"
                  valueExpr="FILTRO"
                  width="300"
                  (onItemClick)="onSeleccAccion($event)"
              ></dx-select-box>
          </div>
        </dxi-item>
    
        <dxi-item *ngIf="esEdicion" location="before">
          <div *dxTemplate>
            <dx-button icon="plus" matTooltip="Nuevo" (onClick)="operGrid($event,'new')" *ngIf="rowNew">
            </dx-button>
          </div>
        </dxi-item>
        <dxi-item *ngIf="esEdicion" location="before">
          <div *dxTemplate>
            <dx-button icon="edit" matTooltip="Actualizar" (onClick)="operGrid($event,'update')" *ngIf="rowEdit">
            </dx-button>
          </div>
        </dxi-item>
        <dxi-item  *ngIf="esEdicion" location="before">
          <div *dxTemplate>
            <dx-button icon="trash" matTooltip="Eliminar" (onClick)="operGrid($event,'delete')" *ngIf="rowDelete">
            </dx-button>
          </div>
        </dxi-item>
        <dxi-item  *ngIf="esEdicion" location="before">
          <div *dxTemplate>
            <dx-button icon="todo" matTooltip="Guardar" (onClick)="operGrid($event,'save')" *ngIf="rowApplyChanges">
            </dx-button>
          </div>
        </dxi-item>
        <dxi-item  *ngIf="esEdicion" location="before">
          <div *dxTemplate>
            <dx-button icon="undo" matTooltip="Cancelar" (onClick)="operGrid($event,'cancel')" *ngIf="rowApplyChanges">
          </dx-button>
            </div>
        </dxi-item>
    </dxo-toolbar>
</dx-data-grid>

<app-xc-combo-grid
    [events]="eventsSubjectGrid.asObservable()"
    (onRespuestaSelecc)="onRespuestaGrid($event)"
  >
</app-xc-combo-grid>
